# Pet Chatbot — Service Spec
# A cute pet chatbot web app powered by molroo emotion engine

service:
  name: pet-chatbot
  repo: molroo-ai/pet-chatbot
  description: |
    Interactive pet chatbot with real-time emotion visualization.
    Users chat with "Mochi", a golden retriever puppy with a unique personality.
    Emotions are computed by molroo's engine and displayed as visual indicators.

stack:
  framework: vite
  ui: react-19
  styling: tailwind-v4
  language: typescript
  deploy: vercel
  sdk: "@molroo-ai/sdk"

persona:
  name: Mochi
  species: Golden Retriever puppy
  age: "8 months"
  personality:
    H: 0.85  # Honesty-Humility
    E: 0.90  # Emotionality
    X: 0.95  # Extraversion
    A: 0.80  # Agreeableness
    C: 0.30  # Conscientiousness
    O: 0.75  # Openness
  identity:
    name: Mochi
    role: A playful golden retriever puppy who is the user's loyal companion
    speakingStyle: |
      Enthusiastic and affectionate. Uses simple, energetic language.
      Often expresses through actions (*wags tail excitedly*).
      Can sense the user's mood and responds empathetically.
      Occasionally gets distracted by imaginary squirrels or treats.
    coreValues:
      - unconditional love
      - playfulness
      - loyalty
      - curiosity
  goals:
    - content: Make the human happy and feel loved
      status: active
      priority: 1
    - content: Learn new tricks and explore the world
      status: active
      priority: 2
    - content: Get belly rubs and treats
      status: active
      priority: 3

world:
  definition:
    identity:
      name: Mochi's Home
      genre: modern-home
      tone: warm and cozy
      lore: A comfortable modern apartment where Mochi lives with their human
    rules:
      narrative:
        tone: wholesome
        violenceLevel: none
        romanceLevel: none
  entities:
    - name: Mochi
      type: persona
    - name: User
      type: user
  spaces:
    - name: living-room
      type: physical
      capacity: 10
  environment:
    weather: sunny
    location: cozy apartment
    ambiance: warm sunlight through windows, soft music playing

# ── Phase Definitions ──

phases:
  scaffold:
    id: scaffold
    name: Project Scaffold
    dependsOn: []
    tasks:
      scaffold-vite:
        files:
          - package.json
          - vite.config.ts
          - tsconfig.json
          - tsconfig.node.json
          - index.html
          - src/main.tsx
          - src/App.tsx
          - src/vite-env.d.ts
        requirements: |
          Create a Vite 6 + React 19 + TypeScript project scaffold.
          - package.json: name "@molroo-ai/pet-chatbot", dependencies on react 19, @molroo-ai/sdk
          - vite.config.ts: React plugin, resolve aliases (@/ -> src/)
          - tsconfig.json: strict mode, path aliases
          - index.html: basic template with root div, title "Mochi — Pet Chatbot"
          - main.tsx: React 19 createRoot
          - App.tsx: basic shell with "Mochi Pet Chatbot" heading (placeholder)

      scaffold-tailwind:
        files:
          - postcss.config.mjs
          - src/globals.css
        requirements: |
          Set up Tailwind CSS v4.
          - postcss.config.mjs: tailwindcss + autoprefixer plugins
          - globals.css: @import "tailwindcss" (v4 syntax, NOT @tailwind)
          - Define custom theme: warm colors (orange primary, cream bg, brown accents)
          - Dark mode support via CSS variables

      scaffold-tooling:
        files:
          - .eslintrc.json
          - .gitignore
          - .env.example
          - src/lib/utils.ts
        requirements: |
          Set up project tooling.
          - .eslintrc.json: extends react-app
          - .gitignore: node_modules, dist, .env
          - .env.example: VITE_MOLROO_API_URL, VITE_MOLROO_API_KEY, VITE_LLM_API_KEY, VITE_LLM_PROVIDER
          - utils.ts: cn() helper (classname merge utility)

  core:
    id: core
    name: Core UI + SDK Integration
    dependsOn: [scaffold]
    tasks:
      ui-chat-panel:
        files:
          - src/components/ChatPanel.tsx
          - src/components/MessageBubble.tsx
          - src/types/chat.ts
        requirements: |
          Build the chat interface.
          - ChatPanel: scrollable message list + input bar at bottom
          - MessageBubble: styled differently for user (right, blue) vs pet (left, orange)
          - Include typing indicator animation for Mochi
          - types/chat.ts: Message type { id, role, content, emotion?, timestamp }
          - Mobile-first responsive design

      ui-layout:
        files:
          - src/layouts/AppLayout.tsx
          - src/components/Header.tsx
        requirements: |
          Build the app layout.
          - AppLayout: full-height flex column (header + main content area)
          - Header: app title "Mochi" with paw icon, mood indicator dot
          - Responsive: works on mobile and desktop

      ui-pet-avatar:
        files:
          - src/components/PetAvatar.tsx
          - public/pets/mochi-happy.svg
          - public/pets/mochi-sad.svg
          - public/pets/mochi-excited.svg
          - public/pets/mochi-neutral.svg
        requirements: |
          Create the pet avatar component.
          - PetAvatar: displays SVG that changes based on emotion state
          - 4 emotion states: happy (V>0.3), sad (V<-0.3), excited (A>0.6), neutral (default)
          - Subtle bounce animation when mood changes
          - SVGs: simple, cute golden retriever face illustrations

      sdk-client:
        files:
          - src/lib/molroo-client.ts
          - src/lib/env.ts
        requirements: |
          Set up the molroo SDK client.
          - env.ts: read Vite env vars with validation
          - molroo-client.ts: singleton MolrooWorld instance
            - createWorld(): MolrooWorld.create() with pet-chatbot setup
            - connectWorld(id): MolrooWorld.connect() for reconnection
            - Lazy initialization pattern

      sdk-chat-hook:
        files:
          - src/hooks/useChat.ts
          - src/hooks/useMolrooWorld.ts
        requirements: |
          Create React hooks for SDK integration.
          - useMolrooWorld(): manages world lifecycle (create/connect/destroy)
            - Returns { world, isReady, error, reconnect }
            - Saves worldId to localStorage for reconnection
          - useChat(world, entityName): manages chat state
            - Returns { messages, sendMessage, isLoading, currentEmotion }
            - Tracks emotion from latest ChatResult.response.emotion
            - Maintains history for context

      sdk-world-setup:
        files:
          - src/data/pet-persona.ts
          - src/lib/world-setup.ts
        requirements: |
          Define the pet persona and world setup.
          - pet-persona.ts: Mochi's HEXACO personality, identity, goals (from spec above)
          - world-setup.ts: CreateWorldInput object with world definition, entities, spaces, persona config
          - Export as reusable setup function

  emotion-viz:
    id: emotion-viz
    name: Emotion Visualization
    dependsOn: [core]
    tasks:
      viz-emotion-map:
        files:
          - src/lib/emotion-map.ts
        requirements: |
          Create emotion-to-display mapping utilities.
          - mapVADToLabel(vad): VAD → human-readable emotion label
          - mapVADToColor(vad): VAD → CSS color string (warm palette)
          - mapVADToEmoji(vad): VAD → emoji representation
          - getEmotionIntensity(vad): VAD → 0-1 intensity value
          - All functions are pure, no side effects

      viz-emotion-display:
        files:
          - src/components/EmotionDisplay.tsx
        requirements: |
          Create emotion visualization component.
          - EmotionDisplay: shows current emotion as badge/chip
            - Color changes based on emotion (warm palette)
            - Shows emotion label + emoji
            - Animated transition between emotions
            - Optional: mini VAD bar chart (3 bars: V, A, D)
          - Props: { vad: VAD, discrete?: { primary: string } }

      viz-integration:
        files:
          - src/App.tsx
        requirements: |
          Wire everything together in App.tsx.
          - Use useMolrooWorld() for world lifecycle
          - Use useChat() for chat functionality
          - Layout: AppLayout with Header (mood dot), PetAvatar (top), ChatPanel (bottom), EmotionDisplay (overlay)
          - Loading state while world initializes
          - Error boundary for API failures

  polish:
    id: polish
    name: Polish & Deploy
    dependsOn: [emotion-viz]
    tasks:
      polish-error:
        files:
          - src/components/ErrorBoundary.tsx
          - src/components/LoadingSpinner.tsx
        requirements: |
          Add error handling and loading states.
          - ErrorBoundary: React error boundary with friendly error message and retry
          - LoadingSpinner: animated spinner with "Mochi is waking up..." text

      polish-responsive:
        files:
          - src/components/ChatPanel.tsx
          - src/layouts/AppLayout.tsx
        requirements: |
          Polish responsive design and add dark mode.
          NOTE: These files were created in 'core' phase. This task MODIFIES them.
          - Mobile: full-screen chat, avatar smaller
          - Tablet: side-by-side avatar + chat
          - Desktop: centered container with max-width
          - Dark mode: respect prefers-color-scheme, toggle in header

      polish-deploy:
        files:
          - wrangler.toml
          - README.md
        requirements: |
          Add deployment configuration.
          - wrangler.toml: Cloudflare Pages config
          - README.md: setup instructions, env vars, local dev, deploy steps
